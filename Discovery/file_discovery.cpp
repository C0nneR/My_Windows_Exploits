#include <stdio.h>
#include <tchar.h>
#include <windows.h>

void EnumerateFile(const TCHAR* pszDirectory) {
    DWORD dwBufferSize = MAX_PATH;
    TCHAR* pszFileMatch = NULL;
    TCHAR* pszFileName = NULL;
    WIN32_FIND_DATA FileData = { 0 };
    BOOL bRet = FALSE;

    pszFileMatch = new TCHAR[dwBufferSize];
    pszFileName = new TCHAR[dwBufferSize];

    wsprintf(pszFileMatch, _T("%s\\*.*"), pszDirectory);

    HANDLE hFile = FindFirstFile(pszFileMatch, &FileData);
    if (INVALID_HANDLE_VALUE != hFile) {
        do {
            if ('.' == FileData.cFileName[0]) {
                continue;
            }

            wsprintf(pszFileName, _T("%s\\%s"), pszDirectory, FileData.cFileName);
            if (FileData.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY) {
                EnumerateFile(pszFileName);
            }
            else {
                wprintf(_T("%s\n"), pszFileName);
            }
        } while (FindNextFile(hFile, &FileData));
    }

    FindClose(hFile);

    delete[] pszFileName;
    pszFileName = NULL;
    delete[] pszFileMatch;
    pszFileMatch = NULL;
}

void main()
{
    EnumerateFile(_T("C:\\Test"));

    system("pause");
    return;
}